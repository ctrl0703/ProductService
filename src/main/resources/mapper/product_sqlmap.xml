<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ibm.kr.product">
<resultMap id="product" type="com.ibm.kr.model.Product">
	<id property="id" column="PRDSEQ"/>
	<result property="name" column="PRDNM"/>
	<result property="imageUrl" column="PRDIMG"/>
	<result property="header" column="PRDNMS"/>
	<result property="basicDescription" column="BASICDESC"/>
	<result property="hashTag" column="HASHTAG"/>
	<result property="price" column="SALPRC"/>
	<result property="restrictCoupon" column="CPNEXFL"/>
	<result property="restrictPoint" column="PTUSENAFL"/>
	<result property="restricNotMember" column="MEMBERONLYFL"/>
	<result property="restrictBuyCount" column="BTYPTUNPAIDFL"/>
	<result property="note" column="PURATTNMTS"/>
	<result property="detailHtmlUrl" column="PRDDTLHTMLURL"/>
	<result property="volume" column="PRDVOL"/>
	<result property="manufacturer" column="MNUFACT"/>
	<result property="manufacturedArea" column="MNUFACTAREA"/>
	<result property="useEndDate" column="USEENDDATE"/>
	<result property="useDescription" column="PRDUSEDESC"/>
	<result property="skin" column="PRDCOMPDESC"/>
	<result property="auditDescription" column="PRDAUDITDESC"/>
	<result property="QADescription" column="QADESC"/>
	<result property="element" column="PRDELEMENT"/>
	<result property="useCareDescription" column="USECAREDESC"/>
	<result property="ASDescription" column="ASDESC"/>
</resultMap>

<resultMap id="category" type="com.ibm.kr.model.Category">
	<id property="id" column="CATEGORY_CODE"/>
	<result property="name" column="NAME"/>
	<result property="order" column="CAT_ORDER"/>
	<result property="superId" column="SUPER_CATEGORY_CODE"/>
</resultMap>

<select id="selectProduct" resultMap="product">
	SELECT *
	FROM PRODUCT
	where prdseq = #{prdseq}
</select>

<select id="selectAll" resultMap="product">
	SELECT *
	FROM PRODUCT
</select>

<select id="selectProductsByCat" resultMap="product">
	SELECT * FROM (
		SELECT *, COUNT(1) OVER() AS PAGETOTCNT FROM (
			SELECT *,
		           ROWNUM AS RNUM
			FROM (
				SELECT A.*
				FROM PRODUCT A, CATEGORY_PRODUCT B
				WHERE B.CATEGORY_CODE = #{id}
				AND A.PRDSEQ = B.PRDSEQ
				ORDER BY PRDSEQ
			)
		)
	) WHERE RNUM <![CDATA[>=]]> #{pageStart} AND RNUM <![CDATA[<]]> #{pageEnd}
</select>

<select id="selectCategory" resultMap="category">
	SELECT CATEGORY_CODE
		  ,NAME 
		  ,CAT_ORDER
	FROM CATEGORY
</select>

<select id="selectCategoryList" resultMap="category">
	SELECT CATEGORY_CODE
		  ,NAME 
		  ,CAT_ORDER
		  ,SUPER_CATEGORY_CODE
	FROM CATEGORY WHERE 1=1
	<if test="superId != null">
		AND SUPER_CATEGORY_CODE = #{superId}
	</if>
	<if test="id != null">
		AND CATEGORY_CODE = #{id}
	</if>
	ORDER BY CAT_ORDER
</select>

</mapper>